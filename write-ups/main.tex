\documentclass[a4paper,12pt]{article}
\input{preamble}

\usepackage{minted}
\usemintedstyle{pastie}
\definecolor{bashcodebg}{rgb}{0.85,0.85,0.85}

%% https://tex.stackexchange.com/questions/173850/problem-in-adding-a-background-color-in-a-minted-environment
%% fix the minted@colorbg environment
\makeatletter
\renewenvironment{minted@colorbg}[1]
 {\def\minted@bgcol{#1}%
  \noindent
  \begin{lrbox}{\minted@bgbox}
  \begin{minipage}{\linewidth-2\fboxsep}}
 {\end{minipage}%
  \end{lrbox}%
  \setlength{\topsep}{\bigskipamount}% set the vertical space
  \trivlist\item\relax % ensure going to a new line
  \colorbox{\minted@bgcol}{\usebox{\minted@bgbox}}%
  \endtrivlist % close the trivlist
 }
\makeatother
\newminted[bash]{bash}{texcl=true, bgcolor=bashcodebg}
%\newminted[bash]{bash}{linenos=true, texcl=true, bgcolor=bashcodebg}

\newcommand{\bashinline}[1]{%
\colorbox{bashcodebg}{%
\parbox[b][0.6em]{\widthof{\mintinline{coq}{#1}}}{\mintinline{coq}{#1}}%
}%
}


\title{\Huge{\textbf{CyberSec}}}
\author{Mateus Marques}

\begin{document}

\maketitle

\section{Linux Fundamentals}

Command \bashinline{uname -a} to discover which Linux distribution you are in.

\n

The \bashinline{PS1} variable can be modified to display useful information, such as full hostname (IP addresses in some cases) and date.

\n

To find help about Linux, have in mind \bashinline{man} and \bashinline{apropos}.

\n

Commands that display system information:
\begin{bash}
whoami, id, hostname, hostnamectl, uname, pwd, ifconfig, ip, netstat,
ss, ps, who, env, lsblk, lsusb, lsof, lspci.
\end{bash}

The command \bashinline{uname -r} can be useful, because we can search for a kernel specific version exploit. Example: search for ``4.15.0-99-generic exploit'', and the first \href{https://www.exploit-db.com/exploits/47163}{result} immediately appears useful to us.

\n

Connect to VPN (\bashinline{sudo} is necessary):
\begin{bash}
sudo openvpn academy-regular.ovpn
\end{bash}

To connect via SSH:
\begin{bash}
ssh [username]@[IP address]
\end{bash}

The command \bashinline{stat} displays metadata about files, for example its inode (index number), birth, last modification, etc.

\n

The \bashinline{tree} command is much more useful than listing one directory by one with \bashinline{ls}.

\n

Commands for file searching: \bashinline{which, find, locate}.

\n

What is the name of the config file that has been created after \bashinline{2020-03-03} and is smaller than \bashinline{28k} but larger than \bashinline{25k}?
\begin{bash}
find / -type f -name *.conf -size +25k -size -28k \
-exec ls -la {} \; 2>/dev/null
\end{bash}

If we try to use the argument \bashinline{-newerBt 2020-03-03} we get
``\texttt{find: This system does not provide a way to find the birth time of a file.}''

\n

How many files exist on the system that have the \bashinline{.bak} extension?
\begin{bash}
find / -type f -name *.bak 2>/dev/null | wc -l
\end{bash}

\n

File descriptors are \bashinline{STDIN - 0}, \bashinline{STDOUT - 1}, \bashinline{STDERR - 2}. We can redirect erros and output with \bashinline{>}. The \bashinline{<} character serves as standard input. To append text to a file, we use \bashinline{>>}. The \bashinline{<< FINISH} serves to enter standard input through a stream until we type \bashinline{"FINISH"} to define the input's end. Usually we use \bashinline{EOF} instead of \bashinline{FINISH}, but it can be any word. The pipe \bashinline{|} is for redirecting standard output to standard input for the next command.
\begin{bash}
find /etc -name shadow 2>/dev/null > results.txt
find /etc -name shadow 2>stderr.txt 1>stdout.txt
cat < input.txt
cat << EOF > stream.txt
find /etc/ -name *.conf 2>/dev/null | grep systemd | wc -l
\end{bash}

\n

Pagers are \bashinline{more} and \bashinline{less}. Command \bashinline{head} for the first lines of input, \bashinline{tail} for the last lines, and \bashinline{sort} to sort the lines.

\n

To filter lines we use \bashinline{grep}. The option \bashinline{-v} is to exclude the filtered results.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin"
\end{bash}

The \bashinline{cut} command is to remove specific delimiters and show the words in a specified position. The option \bashinline{-d} is for the delimiter and \bashinline{-f} for the position.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | cut -d":" -f1
\end{bash}

In the next example, we replace the colon character with space using \bashinline{tr}.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | tr ":" " "
\end{bash}

The tool \bashinline{column} is to display in a tabular form.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | tr ":" " " | column -t
\end{bash}

Of course, \bashinline{sed} and \bashinline{awk} need no introduction.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | tr ":" " " |
awk '{print $1, $NF}' | sed 's/bin/HTB/g'
\end{bash}

Counting lines with \bashinline{wc -l}.

\n

How many services are listening on the target system on all interfaces? (Not on localhost and IPv4 only)

The file \bashinline{/etc/services} is a table for the internet services, port numbers and protocol types. ``Every networking program should look into this file to get the port number (and protocol) for its service''. But this file does not tell us about the active running services.
\begin{bash}
ss -Hl -4 | grep "LISTEN" | grep -v "127\.0\.0" | wc -l
\end{bash}

The command \bashinline{ss} dumps socket (network services) statistics.

\n

Determine what user the ProFTPd server is running under. Submit the username as the answer.
\begin{bash}
ps aux | grep -i "proftpd"
\end{bash}

\n

Use cURL from your Pwnbox (not the target machine) to obtain the source code of the \url{https://www.inlanefreight.com} website and filter all unique paths of that domain. Submit the number of these paths as the answer.
\begin{bash}
curl -L "https://www.inlanefreight.com" > site.html
grep -o "https\?://www\.inlanefreight\.com[^\"']*" site.html |
sort | uniq | wc -l
\end{bash}

\begin{bash}
curl -L "https://www.inlanefreight.com" > site.html
grep -o "https\?://www\.inlanefreight\.com[^\"']*" site.html |
sort | uniq | wc -l
\end{bash}

Change permissions ``\texttt{rwx}'' with \bashinline{chmod} and ownership with \bashinline{chown}.

\n

Besides assigning direct user and group permissions, we can also configure special permissions for files by setting the Set User ID (SUID) and Set Group ID (SGID) bits. These SUID/SGID bits allow, for example, users to run programs with the rights of another user. Administrators often use this to give their users special rights for certain applications or files. The letter ``s'' is used instead of an ``x''. When executing such a program, the SUID/SGID of the file owner is used.

\n
If the administrator sets the SUID bit to \bashinline{journalctl}, any user with access to this application could execute a shell as root. This is because it invokes the pager \bashinline{less}, that can execute arbitrary code.

It can be used to break out from restricted environments by spawning an interactive system shell.
\begin{bash}
journalctl
!/bin/sh
\end{bash}

If the \bashinline{journalctl} is allowed to run as superuser by \bashinline{sudo}, it does not drop the elevated privileges and may be used to access the file system, escalate or maintain privileged access.
\begin{bash}
sudo journalctl
!/bin/sh
\end{bash}

``Sticky bits'' add another level of security for files and directories. Read about it later.

\end{document}
