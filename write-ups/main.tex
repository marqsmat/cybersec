\documentclass[a4paper,12pt]{article}
\input{preamble}

\usepackage{minted}
\usemintedstyle{vs}

\definecolor{bg}{rgb}{0.85,0.85,0.85}
\setmintedinline{bgcolor=bg}
\newcommand{\bashinline}[1]{\mintinline{bash}{#1}}
%\newenvironment{bash}{\VerbatimEnvironment\begin{minted}[bgcolor=bg]{bash}}{\end{minted}}

\usepackage{tcolorbox}
\tcbuselibrary{minted,skins}
\newtcblisting{bash}{
  listing engine=minted,
  colback=bg,
  colframe=black!70,
  listing only,
  minted style=vs,
  minted language=bash,
  minted options={texcl=true},
  left=1mm,
}

\setlength\parindent{0pt}  % noindent in entire file

\title{\Huge{\textbf{CyberSec}}}
\author{Mateus Marques}

\begin{document}

\maketitle

\section{Linux Fundamentals}

Command \bashinline{uname -a} to discover which Linux distribution you are in.

\n

The \bashinline{PS1} variable can be modified to display useful information, such as full hostname (IP addresses in some cases) and date.

\n

To find help about Linux, have in mind \bashinline{man} and \bashinline{apropos}.

\n

Commands that display system information:
\begin{bash}
whoami, id, hostname, hostnamectl, uname, pwd, ifconfig, ip, netstat,
ss, ps, who, env, lsblk, lsusb, lsof, lspci.
\end{bash}

The command \bashinline{uname -r} can be useful, because we can search for a kernel specific version exploit. Example: search for ``4.15.0-99-generic exploit'', and the first \href{https://www.exploit-db.com/exploits/47163}{result} immediately appears useful to us.

\n

Connect to VPN (\bashinline{sudo} is necessary):
\begin{bash}
sudo openvpn academy-regular.ovpn
\end{bash}

To connect via SSH:
\begin{bash}
ssh [username]@[IP address]
\end{bash}

The command \bashinline{stat} displays metadata about files, for example its inode (index number), birth, last modification, etc.

\n

The \bashinline{tree} command is much more useful than listing one directory by one with \bashinline{ls}.

\n

Commands for file searching: \bashinline{which, find, locate}.

\n

What is the name of the config file that has been created after \bashinline{2020-03-03} and is smaller than \bashinline{28k} but larger than \bashinline{25k}?
\begin{bash}
find / -type f -name *.conf -size +25k -size -28k \
-exec ls -la {} \; 2>/dev/null
\end{bash}

If we try to use the argument \bashinline{-newerBt 2020-03-03} we get
``\texttt{find: This system does not provide a way to find the birth time of a file.}''

\n

How many files exist on the system that have the \bashinline{.bak} extension?
\begin{bash}
find / -type f -name *.bak 2>/dev/null | wc -l
\end{bash}

\n

File descriptors are \bashinline{STDIN - 0}, \bashinline{STDOUT - 1}, \bashinline{STDERR - 2}. We can redirect erros and output with \bashinline{>}. The \bashinline{<} character serves as standard input. To append text to a file, we use \bashinline{>>}. The \bashinline{<< FINISH} serves to enter standard input through a stream until we type \bashinline{"FINISH"} to define the input's end. Usually we use \bashinline{EOF} instead of \bashinline{FINISH}, but it can be any word. The pipe \bashinline{|} is for redirecting standard output to standard input for the next command.
\begin{bash}
find /etc -name shadow 2>/dev/null > results.txt
find /etc -name shadow 2>stderr.txt 1>stdout.txt
cat < input.txt
cat << EOF > stream.txt
find /etc/ -name *.conf 2>/dev/null | grep systemd | wc -l
\end{bash}

\n

Pagers are \bashinline{more} and \bashinline{less}. Command \bashinline{head} for the first lines of input, \bashinline{tail} for the last lines, and \bashinline{sort} to sort the lines.

\n

To filter lines we use \bashinline{grep}. The option \bashinline{-v} is to exclude the filtered results.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin"
\end{bash}

The \bashinline{cut} command is to remove specific delimiters and show the words in a specified position. The option \bashinline{-d} is for the delimiter and \bashinline{-f} for the position.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | cut -d":" -f1
\end{bash}

In the next example, we replace the colon character with space using \bashinline{tr}.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | tr ":" " "
\end{bash}

The tool \bashinline{column} is to display in a tabular form.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | tr ":" " " | column -t
\end{bash}

Of course, \bashinline{sed} and \bashinline{awk} need no introduction.
\begin{bash}
cat /etc/passwd | grep -v "false\|nologin" | tr ":" " " |
awk '{print $1, $NF}' | sed 's/bin/HTB/g'
\end{bash}

Counting lines with \bashinline{wc -l}.

\n

How many services are listening on the target system on all interfaces? (Not on localhost and IPv4 only)

The file \bashinline{/etc/services} is a table for the internet services, port numbers and protocol types. ``Every networking program should look into this file to get the port number (and protocol) for its service''. But this file does not tell us about the active running services.
\begin{bash}
ss -Hl -4 | grep "LISTEN" | grep -v "127\.0\.0" | wc -l
\end{bash}

The command \bashinline{ss} dumps socket (network services) statistics.

\n

Determine what user the ProFTPd server is running under. Submit the username as the answer.
\begin{bash}
ps aux | grep -i "proftpd"
\end{bash}

\n

Use cURL from your Pwnbox (not the target machine) to obtain the source code of the \url{https://www.inlanefreight.com} website and filter all unique paths of that domain. Submit the number of these paths as the answer.
\begin{bash}
curl -L "https://www.inlanefreight.com" > site.html
grep -o "https\?://www\.inlanefreight\.com[^\"']*" site.html |
sort | uniq | wc -l
\end{bash}

\begin{bash}
curl -L "https://www.inlanefreight.com" > site.html
grep -o "https\?://www\.inlanefreight\.com[^\"']*" site.html |
sort | uniq | wc -l
\end{bash}

Change permissions ``\texttt{rwx}'' with \bashinline{chmod} and ownership with \bashinline{chown}.

\n

Besides assigning direct user and group permissions, we can also configure special permissions for files by setting the Set User ID (SUID) and Set Group ID (SGID) bits. These SUID/SGID bits allow, for example, users to run programs with the rights of another user. Administrators often use this to give their users special rights for certain applications or files. The letter ``s'' is used instead of an ``x''. When executing such a program, the SUID/SGID of the file owner is used.

\n
If the administrator sets the SUID bit to \bashinline{journalctl}, any user with access to this application could execute a shell as root. This is because it invokes the pager \bashinline{less}, that can execute arbitrary code.

It can be used to break out from restricted environments by spawning an interactive system shell.
\begin{bash}
journalctl
!/bin/sh
\end{bash}

If the \bashinline{journalctl} is allowed to run as superuser by \bashinline{sudo}, it does not drop the elevated privileges and may be used to access the file system, escalate or maintain privileged access.
\begin{bash}
sudo journalctl
!/bin/sh
\end{bash}

``Sticky bits'' add another level of security for files and directories. Read about it later.

\pagebreak

\section{Nmap}

Option \bashinline{-A} enables OS and version detection, script scanning and traceroute (it stands for aggressive).

\n

Option \bashinline{-T4} is for faster execution.

\n

You can specify them with the \bashinline{-T} option and their number (0â€“5) or their name. The template names are paranoid (0),
sneaky (1), polite (2), normal (3), aggressive (4), and insane (5). The first two are for IDS evasion. Polite mode slows down the scan to use less bandwidth and target machine resources. Normal mode is the default and
so \bashinline{-T3} does nothing. Aggressive mode speeds scans up by making the assumption that you are on a reasonably fast and reliable network. Finally insane mode assumes that you are on an extraordinarily fast network or are
willing to sacrifice some accuracy for speed.

\n

Option \bashinline{-p} is to specify port ranges.

\n

Option \bashinline{-sV} is to determine service/version info on open ports.

\n

Look at \bashinline{-sS}. It says it performs a stealthy scan.

Example:
\begin{bash}
nmap -A -T4 -sV "10.129.15.46"
\end{bash}

\pagebreak

\section{HackTheBox}

\subsection{Meow \faLinux}

What tool do we use to test our connection to the target with an ICMP echo request?
\begin{bash}
ping "10.129.74.130"
\end{bash}

What service do we identify on port 23/tcp during our scans?
\begin{bash}
nmap -p 23 "10.129.74.130"
\end{bash}

What username is able to log into the target over telnet with a blank password?
\begin{bash}
telnet -l root "10.129.74.130" 23
cat flag.txt
\end{bash}

\subsection{Fawn \faLinux}

What does the 3-letter acronym FTP stand for? File Transfer Protocol.

Which port does the FTP service listen on usually? Port 21.

What acronym is used for the secure version of FTP? \bashinline{sftp}.

From your scans, what version is FTP running on the target? \bashinline{vsftpd 3.0.3}.

From your scans, what OS type is running on the target? Unix.

What is username that is used over FTP when you want to log in without having an account? From the scan:
\begin{bash}
nmap -sV -A -T4 10.129.15.46
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 0        0              32 Jun 04  2021 flag.txt
\end{bash}

The output \bashinline{ftp-anon} is a \href{https://nmap.org/nsedoc/scripts/ftp-anon.html}{script} from \bashinline{nmap}. It checks if the FTP running service allows for anonymous login.

From GitHub \href{https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt}{Default-Credentials}, we see \bashinline{anonymous:anonymous}.

What is the response code we get for the FTP message ``Login successful''? 230.
\begin{bash}
ftp "10.129.15.46"
Name (10.129.15.46:sekai): anonymous
331 Please specify the password.
Password: anonymous
230 Login successful.
\end{bash}

What is the command used to download the file we found on the FTP server? \bashinline{get}.
\begin{bash}
ftp> ls
ftp> get flag.txt
\end{bash}

\subsection{Dancing \faWindows}

What does the 3-letter acronym SMB stand for? Server Message Block.

What port does SMB use to operate at? Port 445 (or 139, NetBIOS).
\begin{bash}
nmap -sV -A -T4 10.129.71.114
PORT    STATE SERVICE       VERSION
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
Host script results:
| smb2-time:
|   date: 2024-03-21T18:12:02
|_  start_date: N/A
|_clock-skew: 3h59m59s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
\end{bash}

What is the service name for port 445 that came up in our scan? \bashinline{microsoft-ds}.

What is the 'flag' or 'switch' that we can use with the smbclient utility to 'list' the available shares on Dancing?
\begin{bash}
sudo pacman -S smbclient
smbclient -L 10.129.71.114
Password: (empty)
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN\$         Disk      Remote Admin
        C\$             Disk      Default share
        IPC\$           IPC       Remote IPC
        WorkShares      Disk
\end{bash}

What is the name of the share we are able to access in the end with a blank password? WorkShares.

\begin{bash}
smbclient -N //10.129.71.114/Workshares
smb: \> ls
smb: \> cd James.P
smb: \> get flag.txt
\end{bash}

\subsection{Redeemer \faLinux}

Which TCP port is open on the machine? HTB hints that the TCP open port has 4 digits and the last one is 9. Generate a list \bashinline{ports9.txt} with these ports and
\begin{bash}
for port in $(cat ports9.txt) ; do
  nmap -p $port 10.129.70.15 >> scan.txt
done
grep -i "open" scan.txt
\end{bash}

Which service is running on the port that is open on the machine? \bashinline{redis} is open on port 6379.

What type of database is Redis? Choose from the following options: (i) In-memory Database, (ii) Traditional Database.
Googling about Redis, we see that it is an ``in-memory Database''.

Which command-line utility is used to interact with the Redis server? Enter the program name you would enter into the terminal without any arguments.
\begin{bash}
sudo pacman -S redis
redis-cli -h 10.129.70.15
\end{bash}

Once connected to a Redis server, which command is used to obtain the information and statistics about the Redis server? From \url{https://redis.io/commands/}, \bashinline{info}.
\begin{bash}
10.129.70.15:6379> info
10.129.70.15:6379> select 0
10.129.70.15:6379> info
# Keyspace
db0:keys=4,expires=0,avg_ttl=0
10.129.70.15:6379> keys *
10.129.70.15:6379> get flag
\end{bash}


What is the version of the Redis server being used on the target machine? \bashinline{5.0.7}.

Which command is used to select the desired database in Redis? \bashinline{select 0}.

How many keys are present inside the database with index 0? 4

\subsection{Explosion \faWindows}
What does the 3-letter acronym RDP stand for? Remote Desktop Protocol.

What is a 3-letter acronym that refers to interaction with the host through a command line interface? cli.

What about graphical user interface interactions? gui.

What is the name of an old remote access tool that came without encryption by default and listens on TCP port 23? telnet.

What is the name of the service running on port 3389 TCP? ms-wbt-server.

What is the switch used to specify the target host's IP when using xfreerdp? \bashinline{/v:}.

What username successfully returns a desktop projection to us with a blank password? Administrator.
\begin{bash}
sudo pacman -S freerdp
xfreerdp /v:10.129.150.101:3389 /u:Administrator
\end{bash}

\subsection{Preignition \faLinux}

<++>

\end{document}
